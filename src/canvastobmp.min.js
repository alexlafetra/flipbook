var CanvasToBMP={toArrayBuffer:function(t,e,n="BITMAPINFOHEADER"){let a;switch(n){default:case"BITMAPINFOHEADER":a=54;break;case"BITMAPV4HEADER":a=122}var o,f,i,r,s=t.width,u=t.height,c=s<<2,l=t.getContext("2d").getImageData(0,0,s,u),A=new Uint32Array(l.data.buffer),B=4*s,b=B*u,h=a+b,T=new ArrayBuffer(h),d=new DataView(T),y=1<<20,g=y,w=0,E=0,R=0;switch(n){default:case"BITMAPINFOHEADER":U(19778),m(h),I(4),m(a),m(40),m(s),m(-u>>>0),U(1),U(32),m(0),m(b),m(2835),m(2835),m(0),m(0);break;case"BITMAPV4HEADER":U(19778),m(h),I(4),m(a),m(108),m(s),m(-u>>>0),U(1),U(32),m(3),m(b),m(2835),m(2835),m(0),m(0),m(16711680),m(65280),m(255),m(4278190080),m(1466527264);for(let t=0;t<9;t++)m(0)}function U(t){d.setUint16(E,t,!0),E+=2}function m(t){d.setUint32(E,t,!0),E+=4}function I(t){E+=t}!function t(){for(;w<u&&g>0;){for(r=a+w*B,o=0;o<c;)g--,f=A[R++],i=f>>>24,d.setUint32(r+o,f<<8|i),o+=4;w++}R<A.length?(g=y,setTimeout(t,CanvasToBMP._dly)):e(T)}()},toBlob:function(t,e){this.toArrayBuffer(t,(function(t){e(new Blob([t],{type:"image/bmp"}))}))},toObjectURL:function(t,e){this.toBlob(t,(function(t){var n=self.URL||self.webkitURL||self;e(n.createObjectURL(t))}))},toDataURL:function(t,e){this.toArrayBuffer(t,(function(t){var n=new Uint8Array(t),a=1<<20,o=a,f="",i="",r=0,s=n.length;!function t(){for(;r<s&&o-- >0;)f+=String.fromCharCode(n[r++]);r<s?(o=a,setTimeout(t,CanvasToBMP._dly)):(r=0,s=f.length,o=18e4,function t(){i+=btoa(f.substr(r,o)),(r+=o)<s?setTimeout(t,CanvasToBMP._dly):e("data:image/bmp;base64,"+i)}())}()}))},_dly:9};